{% extends "base.html" %}
{% block content %}
<h2>Reservas de mi Hotel</h2>
<a href="{% url 'crear-reserva-empleado' %}">Crear nueva reserva</a><br><br>

<table border="1">
  <tr>
    <th>Reserva</th>
    <th>Usuario</th>
    <th>Estado</th>
    <th>Check-in</th>
    <th>Check-out</th>
    <th>Habitaciones</th>
    <th>Acciones</th>
  </tr>
  {% for item in reservas_con_habitaciones %}
    <tr>
      <td>#{{ item.reserva.id }}</td>
      <td>{{ item.reserva.usuario.email }}</td>
      <td>{{ item.reserva.estado }}</td>
      <td>{{ item.reserva.fecha_checkin }}</td>
      <td>{{ item.reserva.fecha_checkout }}</td>
      <td>
        {% for h in item.habitaciones %}
          {{ h.habitacion.numero }} ({{ h.habitacion.tipo }})<br>
        {% endfor %}
      </td>
      <td>
        <a href="{% url 'cambiar-estado-reserva' item.reserva.id %}" onclick="openModal(event, this.href)">Cambiar Estado</a>
      </td>
    </tr>
  {% empty %}
    <tr>
      <td colspan="7">No hay reservas.</td>
    </tr>
  {% endfor %}
</table>

<!-- Modal -->
<div id="estadoModal" style="display:none; position:fixed; top:5%; left:10%; width:80%; height:90%; background:#fff; border:2px solid #333; z-index:1000;">
  <div style="text-align:right; background:#f2f2f2; padding:10px;">
    <button onclick="closeModal()">Cerrar</button>
  </div>
  <iframe id="estadoIframe" style="width:100%; height:90%; border:none;"></iframe>
</div>

<script>
  function openModal(event, url) {
    event.preventDefault();
    document.getElementById("estadoModal").style.display = "block";
    document.getElementById("estadoIframe").src = url;
  }

  function closeModal() {
    document.getElementById("estadoModal").style.display = "none";
    document.getElementById("estadoIframe").src = "";
  }
</script>

{% endblock %}
